// Generated by CoffeeScript 1.4.0
(function() {
  var canvas, ctx, onError, onSuccess, update, video, ws;

  onError = function(e) {
    return console.log("Rejected", e);
  };

  onSuccess = function(localMediaStream) {
    console.log(localMediaStream);
    return video.src = webkitURL.createObjectURL(localMediaStream);
  };

  update = function() {
    ctx.drawImage(video, 0, 0, 320, 240);
    return canvas.toBlob(function(blob) {
      return ws.send(blob);
    }, 'image/jpeg');
  };

  video = document.querySelector('video');

  canvas = document.querySelector('canvas');

  ctx = canvas.getContext('2d');

  ws = new WebSocket("ws://" + location.host + "/socket");

  ws.onopen = function() {
    return console.log("Opened websocket");
  };

  setInterval(update, 1250);

  navigator.webkitGetUserMedia({
    'video': true,
    'audio': false
  }, onSuccess, onError);

}).call(this);
